Fixed the bug and tested it. Please review the code before commiting to main branch
